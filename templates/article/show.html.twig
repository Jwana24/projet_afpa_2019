{% extends 'base.html.twig' %}

{% block title %}Articles{% endblock %}

{% block body %}

    <table>
        <tr>
            <td>{{article.TitleArticle}}</td>
            <td>{{article.DateArticle|date('d-m-y')}}</td>
            <td>{{article.TextArticle|slice(0, 150)}}</td>
            <td>{{likes}}</td>
        </tr>
    </table>

    {% if is_granted('ROLE_ADMIN') %}
        {{ include('Admin/article/delete.html.twig') }}
        <a href="{{ path('article_edit', {'id' : article.Id}) }}">Editer</a>
    {% endif %}

    {% if user %}
        {{ form_start(form) }}
        {{ form_widget(form) }}
        <input type="submit" value="Envoyer">
        {{ form_end(form) }}
    {% else %}
        <p>Vous devez être connecté pour pouvoir poster un commentaire</p>
    {% endif %}

    {% if user %}
        {{ form_start(formLike) }}
        {{ form_widget(formLike) }}
        <input type="submit" value="Liker">
        {{ form_end(formLike) }}
    {% else %}
        <p>Vous devez être connecté pour pouvoir liker un commentaire</p>
    {% endif %}
    
    {% for comment in comments %}
        <article>
            <p>{{ comment.DateComment|date('d-m-Y') }}</p>
            <p>{{ comment.IdMemberFK.username }}</p>
            <p>{{ comment.TextComment }}</p>

            {% if is_granted('MODIF', comment) %}
                <a href="{{ path('edit_comment', {'id':comment.Id}) }}">Editer</a>
            {% endif %}

            {% if is_granted('MODIF', comment) %}
                {{ include('article/comments/delete.html.twig') }}
            {% endif %}

            {% for response in comment.getResponses %}
            <section>
                <p>{{ response.DateResponse|date('d-m-Y') }}</p>
                <p>{{ response.IdMemberFK.username }}</p>
                <p>{{ response.TextResponse }}</p>

                {% if is_granted('MODIFRESPONSE', response) %}
                    <a href="{{ path('edit_response', {'id':response.Id}) }}">Editer</a>
                {% endif %}

                {% if is_granted('MODIFRESPONSE', response) %}
                    {{ include('article/responses/delete.html.twig') }}
                {% endif %}
            </section>
            {% endfor %}

            {{ form_start(formResponse) }}
            {{ form_widget(formResponse) }}
            <input type="hidden" value="{{ comment.Id }}" name="id_comment">
            <input type="submit" value="Répondre">
            {{ form_end(formResponse) }}

        </article>

    {% endfor %}
    
    <a href="{{ path('articles_list') }}">Revenir à la liste des articles</a>

    {% for message in app.flashes('success') %}
        <div id="flash-notice" class="text-center mx-auto">
            {{ message }}
        </div>
    {% endfor %}

{% endblock %}